(()=>{const c=()=>{try{ix}catch{return setTimeout(c,1)}const d=ix.el.byId("login-form"),p=ix.el.byId("flash-subtitles"),u=ix.el.byId("email"),x=ix.el.byId("username"),y=ix.el.byId("password"),m=ix.el.byId("password2"),f=ix.el.byId("submit-btn"),v=ix.el.byId("goto-login");var e=ix.el.byId("goto-signup"),i=ix.el.byId("goto-reset-pw");const s=ix.el.byId("goto-login-after-resetpw");let t="login";[u,x,y,m].forEach(i=>{ix.el.addListener(i,"focus",e=>{i.parentElement.classList.remove("bd-2"),i.parentElement.classList.add("bd-2h")}),ix.el.addListener(i,"blur",e=>{i.parentElement.classList.remove("bd-2h"),i.parentElement.classList.add("bd-2")})}),ix.el.addListener(m,"paste",e=>{setTimeout(()=>ix.popup.message("Please ensure that the password is spelled correctly.",{callback:()=>m.focus()}),0)}),ix.el.addListener(u,"keyup",e=>{u.value&&"Enter"===e.key&&x.focus()}),ix.el.addListener(x,"keyup",e=>{x.value&&"Enter"===e.key&&y.focus()}),ix.el.addListener(y,"keyup",e=>{y.value&&"Enter"===e.key&&("login"===t?f.click():m.focus())}),ix.el.addListener(m,"keyup",e=>{m.value&&"Enter"===e.key&&f.click()});const b=(e,i)=>ix.api.send("login",{username:e,password:i}),l=(ix.api.setHandler("login",e=>{var{status:e,id:i,message:s}=e;e?(ix.cookies.set(ix.chee.config.sessName,i),e=atob(ix.query.get("next")||""),loc.href="/"===e[0]?e:"/"):ix.popup.message(s)}),s=>{var e=ix.el.childrenR(d).concat(ix.el.childrenR(p));const t=["cpn-login","cpn-signup","cpn-reset"].filter(e=>e!=s);e.forEach(e=>{if(e.classList.contains(s))ix.el.show(e);else for(const i of[...t])if(e.classList.contains(i)){ix.el.hide(e);break}})}),a=e=>{var i=x.value,s=y.value;return i?s?void b(i,s):ix.popup.message("Password cannot be empty.",{callback:()=>y.focus()}):ix.popup.message("Username cannot be empty.",{callback:()=>x.focus()})},h=e=>{const i=u.value,s=x.value,t=y.value;var l=m.value;for(const r of[["Email",i,u],["Username",s,x],["Passwd",t,y]]){const[c,o,n]=r;try{ix.chee.valid["test"+c](o)}catch(e){return ix.popup.message(e,{callback:()=>n.focus()})}}if(t!=l)return ix.popup.message("Passwords do not match.",{callback:()=>m.focus()});u.value="",setTimeout(()=>{u.value=i},1);const a=x;a.placeholder="6 digits code",a.maxLength=6,a.classList.add("tx-ct","w-100"),a.value="",a.parentElement.childNodes[0].remove(),a.parentElement.style.width="120px",a.parentElement.classList.add("mg-b32"),ix.el.addListener(a,"keyup",e=>{6===a.value.length&&f.click()}),ix.el.hide(y.parentElement),ix.el.hide(m.parentElement),ix.el.hide(v.parentElement),d.insertBefore(ix.el("div",{class:"mg-0 flex-ct flex-col sz-16"},[ix.el("div",{class:"tx-ct mg-t32 bold tx-ct"},[],"We have sent a verification code to your email, please check your inbox."),ix.el("div",{class:"tx-ct mg-y16"},[],"Please enter the verification code."),a.parentElement]),f),p.remove(),doc.body.style.setProperty("--flash-subtitles-h","0px"),doc.body.style.setProperty("--flash-subtitles-top","20vh"),d.insertBefore(ix.el("a",{href:`?p=signup&ea=${i}&user=`+s,class:"mg-t8"},[],"Resubmit the form"),ix.el.byId("signup-hint")),f.innerText="Sign Up!",a.focus(),ix.api.send("verifyEmail",{emailAddress:i,reference:"signup-vrf"}),ix.api.setHandler("checkVerificationCode",e=>{if(ix.el.unlock(f),!e)return ix.popup.message("Invalid verification code.",{callback:()=>a.focus()});b(s,t)}),ix.el.rmvListener(f,"click",h),ix.el.addListener(f,"click",()=>{ix.el.lock(f),ix.api.send("checkVerificationCode",{username:s,email:i,password:t,code:a.value,reference:"signup-vrf"}),ix.popup.show("Please wait, registration is in progress...",{isTemporary:1})})},r=(ix.api.setHandler("reset-pw",()=>{const e=()=>ix.popup.message("Has the verification been completed?",{buttons:[{text:"Yes",callback:()=>s.click()},{text:"No",callback:e}]});ix.popup.message("A verification email has been sent to you, please check your inbox.",{callback:()=>{e()}})}),()=>{var e=u.value,i=y.value;for(const s of[["Email",e,u],["Passwd",i,y]]){const[t,l,a]=s;try{ix.chee.valid["test"+t](l)}catch(e){return ix.popup.message(e,{callback:()=>a.focus()})}}ix.api.send("reset-pw",{resetPwOr:loc.origin,resetPwEa:e,resetPwPw:i})});ix.el.addListener(v,"click",e=>{e.preventDefault(),t="login",ix.query.set("p","login",1),f.innerText="Log In",ix.el.rmvListener(f,"click",h),ix.el.addListener(f,"click",a),l("cpn-login"),doc.body.style.setProperty("--flash-subtitles-top","15vh"),doc.body.style.setProperty("--flash-subtitles-h","192px"),x.focus()}),ix.el.addListener(e,"click",e=>{e.preventDefault(),t="signup",ix.query.set("p","signup",1),f.innerText="Next",ix.el.rmvListener(f,"click",a),ix.el.addListener(f,"click",h),l("cpn-signup"),doc.body.style.setProperty("--flash-subtitles-top","7.5vh"),ix.cli.device.isMobile&&doc.body.style.setProperty("--flash-subtitles-h","96px"),u.focus()}),ix.el.addListener(i,"click",e=>{e.preventDefault(),t="reset-pw",ix.query.set("p","reset-pw",1),d.id="",y.value="",y.placeholder="New password",f.innerText="Verify your email",ix.el.rmvListener(f,"click",a),ix.el.addListener(f,"click",r),l("cpn-reset"),u.focus()}),ix.el.addListener(s,"click",e=>{e.preventDefault(),d.id="login-form",y.placeholder="Password",ix.el.rmvListener(f,"click",r),ix.el.addListener(f,"click",a),v.click()}),his.length<2&&(ix.el.byId("back-btn").href="/"),("signup"===ix.query.get("p")?e:"reset-pw"===ix.query.get("p")?i:v).click(),u.value=ix.query.get("ea")||"",x.value=ix.query.get("user")||"",ix.query.has("ea")&&(ix.query.has("user")?y:x).focus(),ix.query.remove("ea"),ix.query.remove("user",1)};c()})();
(()=>{const S=()=>{try{ix}catch{return setTimeout(S,1)}const n=ix.el.byId("data-source"),t=ix.el.byId("word-title"),i=ix.el.byId("word-list"),e=ix.el.byId("word-card");var s=ix.el.byId("next-btn");const l=ix.el.byId("prev-btn"),r=ix.el.byId("word-description"),o=ix.el.byId("switch-content"),c=ix.el.byId("translate-view"),d=ix.el.byId("translate-view-open-btn");var a=ix.el.byId("translate-view-close-btn");const x=ix.el.byId("scroll-to-top");var p=ix.el.byId("reset-btn");const h=ix.el.byId("keys-hint"),u=[],y=[],g=[],w={};let b=0,k,f,L,v=!1;ix.el.addListener(d,"click",()=>{d.classList.add("op-0"),d.style.transform="translate(-8vw,0)",ix.el.lock(d),c.classList.add("opened"),v=!0}),ix.el.addListener(a,"click",()=>{d.classList.remove("op-0"),d.style.transform="",ix.el.unlock(d),c.classList.remove("opened"),v=!1});const m=e=>{L===f?(b=1,o.innerText="查看字卡",e&&e()):(L=f,i.innerHTML="正在加載...",setTimeout(()=>{ix.el.destroyChildren(i),i.append(...u.map(e=>ix.el("li",{},[ix.el("strong",{},[],e[0]),ix.el("div",{style:"margin-bottom:16px"},[],e[1])]))),o.innerText="查看字卡",b=1,e&&e()},100))},I=(ix.el.addListener(o,"click",()=>{0===b?(ix.el.lock(o),ix.el.hide(e),ix.el.hide(h),ix.el.show(i),ix.el.show(x),m(()=>ix.el.unlock(o))):(o.innerText="查看列表",b=0,ix.el.hide(i),ix.el.hide(x),ix.el.show(e),ix.el.show(h))}),ix.el.addListener(x,"click",()=>{ix.el.scrollToTop(i)}),ix.el.addListener(doc,"mouseup",()=>{var e,t;win.getSelection&&(e=win.getSelection().toString())&&v&&((t=c.getElementsByTagName("textarea")[0]).value=e,ix.el.getListener(t,"keyup")())}),e=>{for(ix.el.destroyChildren(t),ix.el.destroyChildren(r),t.appendChild(ix.el("span",{class:"fadeIn",style:"--trans:.3s"},[],e[0])),r.appendChild(ix.el("span",{class:"fadeIn",style:"--trans:.3s"},[],e[1]));y.length>u.length;)y.shift();for(;g.length>u.length;)g.shift();y.length?l.classList.contains("locked")&&(l.classList.remove("locked"),l.classList.remove("op-025")):l.classList.contains("locked")||(l.classList.add("locked"),l.classList.add("op-025"))}),T=()=>{y.length&&(g.push(k),k=y.pop(),I(k))},A=()=>{k&&y.push(k),g.length||g.push(...ix.chee.random.shuffle(u)),k=g.pop(),I(k)};if(doc.onkeyup=e=>{e.target==doc.body&&(["Enter"," ","ArrowDown","ArrowRight","PageDown"].includes(e.key)&&A(),["Backspace","ArrowUp","ArrowLeft","PageUp"].includes(e.key))&&T()},ix.el.addListener(s,"click",A),ix.el.addListener(l,"click",T),ix.cli.device.isTouchScreen||(h.innerText=`按下whitespace、enter、pgdn、→ 和 ↓ 可以查看下一個。
按下backenter、pgup、← 和 ↑ 可以查看上一個。`),ix.query.has("src"))for(const R of n.children)if(R.innerText===ix.query.get("src")){R.selected=!0;break}const C=()=>{try{var[e,t]=n.value.split(":"),i="/static/sources/en-learning/"+t;for(const s of n.children)s.selected&&ix.query.set("src",s.innerText,1);if("0"!==e)return ix.popup.throw("Oops! Unable to process data source.");{text=(e=>{if(!w[e]){var t=ix.nw.xhr.get(e,{async:!1});if(200!==t.status)throw"Resource not found";w[e]={text:t.responseText}}return f&&(w[f]={text:w[f].text,previous:[...y],next:[...g],current:k}),u.length=0,f=e,y.length=0,g.length=0,y.push(...w[e].previous||[]),g.push(...w[e].next||[]),k=w[e].current,w[f].text})(i);const l=/^([^=]+)=(.*)?$/;u.push(...(text.split("---\r\n")[1]||text.split("---\n")[1]||text.split("---\r")[1]).split("\n").map(e=>e.replaceAll("\r","").match(l).slice(1,3)))}A(),T(),1===b&&m()}catch(e){ix.popup.throw(e?"ERROR: "+e:"Oops! Something went wrong!")}};ix.el.addListener(n,"input",C),ix.el.addListener(p,"click",()=>{for(const e of Object.keys(w))delete w[e];f=null,C()}),C()};S()})();